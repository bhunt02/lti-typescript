<html><head><style>
html {
    box-sizing: border-box
}

body {
  padding: 2rem;
}

*,*:before,*:after {
    box-sizing: inherit
}

/* Extract from normalize.css by Nicolas Gallagher and Jonathan Neal git.io/normalize */
html {
    -ms-text-size-adjust: 100%;
    -webkit-text-size-adjust: 100%
}

body {
    margin: 0
}

article,aside,details,figcaption,figure,footer,header,main,menu,nav,section {
    display: block
}

summary {
    display: list-item
}

audio,canvas,progress,video {
    display: inline-block
}

progress {
    vertical-align: baseline
}

audio:not([controls]) {
    display: none;
    height: 0
}

[hidden],template {
    display: none
}

a {
    background-color: transparent
}

a:active,a:hover {
    outline-width: 0
}

abbr[title] {
    border-bottom: none;
    text-decoration: underline;
    text-decoration: underline dotted
}

b,strong {
    font-weight: bolder
}

dfn {
    font-style: italic
}

mark {
    background: #ff0;
    color: #000
}

small {
    font-size: 80%
}

sub,sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline
}

sub {
    bottom: -0.25em
}

sup {
    top: -0.5em
}

figure {
    margin: 1em 40px
}

img {
    border-style: none
}

code,kbd,pre,samp {
    font-family: monospace,monospace;
    font-size: 1em
}

hr {
    box-sizing: content-box;
    height: 0;
    overflow: visible
}

button,input,select,textarea,optgroup {
    font: inherit;
    margin: 0
}

optgroup {
    font-weight: bold
}

button,input {
    overflow: visible
}

button,select {
    text-transform: none
}

button,[type=button],[type=reset],[type=submit] {
    -webkit-appearance: button
}

button::-moz-focus-inner,[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner {
    border-style: none;
    padding: 0
}

button:-moz-focusring,[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring {
    outline: 1px dotted ButtonText
}

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: .35em .625em .75em
}

legend {
    color: inherit;
    display: table;
    max-width: 100%;
    padding: 0;
    white-space: normal
}

textarea {
    overflow: auto
}

[type=checkbox],[type=radio] {
    padding: 0
}

[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button {
    height: auto
}

[type=search] {
    -webkit-appearance: textfield;
    outline-offset: -2px
}

[type=search]::-webkit-search-decoration {
    -webkit-appearance: none
}

::-webkit-file-upload-button {
    -webkit-appearance: button;
    font: inherit
}

/* End extract */
html,body {
    font-family: Verdana,sans-serif;
    font-size: 15px;
    line-height: 1.5
}

html {
    overflow-x: hidden
}

h1 {
    font-size: 36px
}

h2 {
    font-size: 30px
}

h3 {
    font-size: 24px
}

h4 {
    font-size: 20px
}

h5 {
    font-size: 18px
}

h6 {
    font-size: 16px
}

.breadcrumb {
  padding: 0 0.5rem;
}

.breadcrumb ol {
  display: flex;
  flex-wrap: wrap;
  list-style: none;
  margin: 0;
  padding: 0;
  gap: 1rem;
  align-items: end;
}
</style><title>The problem with Redirection URIs</title></head><nav aria-label="Breadcrumb" class="breadcrumb"><ol><li><a href="/out/README.html">README</a></li><li><a href="/out/docs/DeepLinking.html">Deep Linking</a></li><li><a href="/out/docs/DynamicRegistration.html">Dynamic Registration</a></li><li><a href="/out/docs/Grading.html">Grading</a></li><li><a href="/out/docs/Introduction.html">Introduction</a></li><li><a href="/out/docs/NamesAndRoles.html">Names And Roles</a></li><li><a href="/out/docs/Platform.html">Platform</a></li><li><a href="/out/docs/RedirectionURIs.html">Redirection URIs</a></li><li><a href="/out/docs/TableOfContents.html">Table Of Contents</a></li></ol></nav><body><h1 id="theproblemwithredirectionuris">The problem with Redirection URIs</h1>
<hr>
<h2 id="problemplatformspecificimplementationsoflti">Problem: Platform-Specific Implementations of LTI</h2>
<p>During the launch of a LTI tool the Platform starts the login flow by sending a request containing a <code class="prettyprint">target_link_uri</code> that determines the desired final endpoint for this specific launch, the Tool then redirects to the Platform's authentication endpoint sending a <code class="prettyprint">redirect_uri</code> parameter that tells the Platform to which exact endpoint it's supposed to redirect to at the end of the login flow. </p>
<p>According to the OAuth2 specification, the <code class="prettyprint">redirect_uri</code> parameter should be matched with the redirection URIs registered inside the Platform. The problem is the inconsistency of implementations when it comes to whether or not the query portion of a URL should be taken into consideration. This inconsistency, combined with incomplete support of <code class="prettyprint">custom parameters</code> creates a situation where Tools can't use a single resource selection strategy for every LMS.</p>
<p>Using as an example two of the most popular LMSs, Canvas and Moodle, we can easily see the issue: </p>
<table>
   <thead>
      <tr>
         <th>
            LMS
         </th>
         <th>
            URL Parameters
         </th>
         <th>
            Custom Parameters (Deep Linking)
         </th>
      </tr>
   </thead>
   <tbody>
   <tr>
      <td>
         Canvas
      </td>
      <td align="center">
         ✔️
      </td>
      <td align="center">
         ✖️
      </td>
   </tr>
   <tr>
      <td>
         Moodle
      </td>
      <td align="center">
         ✖️
      </td>
      <td align="center">
         ✔️
      </td>
   </tr>
   </tbody>
</table>
<h2 id="thesolution">The Solution</h2>
<p>The solution LTI-Typescript implements to provide developers with an unified resource selection strategy, without breaking the OAuth2 protocol, is receiving a <code class="prettyprint">target_link_uri</code> with URL Parameters, using the OAuth2 <code class="prettyprint">state</code> token as a key to store the parameters, cleaning the <code class="prettyprint">redirect_uri</code> down to it's registered form and reapplying the URL parameters once the launch flow is finished. </p>
<p>Using this strategy, URL Parameters can be used to select resources dynamically in any LMS:</p>
<ul>
<li><p>Received <code class="prettyprint">target_link_uri</code>: </p>
<p> <code class="prettyprint">https://tool.com?resource=123</code></p></li>
<li><p>URL Parameters stored using state as the key: </p>
<pre class="prettyprint linenums"><code>{ 
  state: "12uy3g8asd7123vasdjhv123876asd", 
  query: { resource: "123" } 
}
</code></pre></li>
<li><p>Returned <code class="prettyprint">redirect_uri</code>: </p>
<p> <code class="prettyprint">https://tool.com</code></p></li>
<li><p>After launch is complete, URL parameters are retrieved and reapplied to URL: </p>
<p> <code class="prettyprint">https://tool.com?resource=123</code></p></li>
</ul>
<hr>
<h2 id="license">License</h2>
<blockquote>
  <p><a href="../LICENSE">APACHE2 License</a></p>
  <p><em>Learning Tools Interoperability&#174; (LTI&#174;) is a trademark of the IMS Global Learning Consortium, Inc. (https://www.imsglobal.org)</em></p>
  <p><em>This library is a derivative work of <a href="https://github.com/Cvmcosta">CVM Costa</a>'s original <a href="https://github.com/Cvmcosta/ltijs">LTIJS library</a>.</em> </p>
</blockquote></body></html>
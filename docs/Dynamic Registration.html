<html><head><style>
html {
    box-sizing: border-box
}

body {
  padding: 2rem;
}

*,*:before,*:after {
    box-sizing: inherit
}

/* Extract from normalize.css by Nicolas Gallagher and Jonathan Neal git.io/normalize */
html {
    -ms-text-size-adjust: 100%;
    -webkit-text-size-adjust: 100%
}

body {
    margin: 0
}

article,aside,details,figcaption,figure,footer,header,main,menu,nav,section {
    display: block
}

summary {
    display: list-item
}

audio,canvas,progress,video {
    display: inline-block
}

progress {
    vertical-align: baseline
}

audio:not([controls]) {
    display: none;
    height: 0
}

[hidden],template {
    display: none
}

a {
    background-color: transparent
}

a:active,a:hover {
    outline-width: 0
}

abbr[title] {
    border-bottom: none;
    text-decoration: underline;
    text-decoration: underline dotted
}

b,strong {
    font-weight: bolder
}

dfn {
    font-style: italic
}

mark {
    background: #ff0;
    color: #000
}

small {
    font-size: 80%
}

sub,sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline
}

sub {
    bottom: -0.25em
}

sup {
    top: -0.5em
}

figure {
    margin: 1em 40px
}

img {
    border-style: none
}

code,kbd,pre,samp {
    font-family: monospace,monospace;
    font-size: 1em
}

hr {
    box-sizing: content-box;
    height: 0;
    overflow: visible
}

button,input,select,textarea,optgroup {
    font: inherit;
    margin: 0
}

optgroup {
    font-weight: bold
}

button,input {
    overflow: visible
}

button,select {
    text-transform: none
}

button,[type=button],[type=reset],[type=submit] {
    -webkit-appearance: button
}

button::-moz-focus-inner,[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner {
    border-style: none;
    padding: 0
}

button:-moz-focusring,[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring {
    outline: 1px dotted ButtonText
}

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: .35em .625em .75em
}

legend {
    color: inherit;
    display: table;
    max-width: 100%;
    padding: 0;
    white-space: normal
}

textarea {
    overflow: auto
}

[type=checkbox],[type=radio] {
    padding: 0
}

[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button {
    height: auto
}

[type=search] {
    -webkit-appearance: textfield;
    outline-offset: -2px
}

[type=search]::-webkit-search-decoration {
    -webkit-appearance: none
}

::-webkit-file-upload-button {
    -webkit-appearance: button;
    font: inherit
}

/* End extract */
html,body {
    font-family: Verdana,sans-serif;
    font-size: 15px;
    line-height: 1.5
}

html {
    overflow-x: hidden
}

h1 {
    font-size: 36px
}

h2 {
    font-size: 30px
}

h3 {
    font-size: 24px
}

h4 {
    font-size: 20px
}

h5 {
    font-size: 18px
}

h6 {
    font-size: 16px
}

.breadcrumb {
  padding: 0 0.5rem;
}

.breadcrumb ol {
  display: flex;
  flex-wrap: wrap;
  list-style: none;
  margin: 0;
  padding: 0;
  gap: 1rem;
  align-items: end;
}
</style><title>Dynamic Registration Service Class Documentation</title></head><nav aria-label="Breadcrumb" class="breadcrumb"><ol><li><a href="/out/README.html">README</a></li><li><a href="/out/docs/Deep Linking.html">Deep Linking</a></li><li><span aria-current="page">Dynamic Registration</span></li><li><a href="/out/docs/Grading.html">Grading</a></li><li><a href="/out/docs/Introduction.html">Introduction</a></li><li><a href="/out/docs/Names and Roles.html">Names and Roles</a></li><li><a href="/out/docs/Platform.html">Platform</a></li><li><a href="/out/docs/Redirection URIs.html">Redirection URIs</a></li><li><a href="/out/docs/Table of Contents.html">Table of Contents</a></li></ol></nav><body><h1 id="dynamicregistrationserviceclassdocumentation">Dynamic Registration Service Class Documentation</h1>
<h2 id="tableofcontents">Table of Contents</h2>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#license">License</a></li>
</ul>
<hr>
<h2 id="introduction">Introduction</h2>
<p>This library supports Dynamic Registation of LTI tools by LTI platforms.</p>
<p>Dynamic registration turns the LTI registration flow into a fast, completely automatic process. Ltijs exposes a registration endpoint through which Platforms can initiate the registration flow.</p>
<hr>
<h2 id="usage">Usage</h2>
<h3 id="settingupdynamicregistration">Setting up Dynamic Registration</h3>
<p>Dynamic registration needs to be setup through the <code class="prettyprint">Provider.setup()</code> method through the <code class="prettyprint">options.dynReg</code> and <code class="prettyprint">options.dynRegRoute</code> (or <code class="prettyprint">options.dynRegUrl</code>) fields.</p>
<ul>
<li><p> <code class="prettyprint">dynRegRoute</code>/ <code class="prettyprint">dynRegUrl</code>: Dynamic registration route. Defaults to <code class="prettyprint">/register</code>.</p></li>
<li><p> <code class="prettyprint">dynReg</code>: Dynamic registration configuration object. </p></li>
<li><p> <code class="prettyprint">url</code>: Tool Provider URL. Required field. Example: <code class="prettyprint">http://tool.example.com</code>.</p></li>
<li><p> <code class="prettyprint">name</code>: Tool Provider name. Required field. Example: <code class="prettyprint">Tool Provider</code>.</p></li>
<li><p> <code class="prettyprint">logo</code>: Tool Provider logo URL. Example: <code class="prettyprint">http://tool.example.com/assets/logo.svg</code>.</p></li>
<li><p> <code class="prettyprint">description</code>: Tool Provider description.</p></li>
<li><p> <code class="prettyprint">redirectUris</code>: Additional redirection URLs. The main URL is added by default. Example: <code class="prettyprint">['http://tool.example.com/launch']</code>.</p></li>
<li><p> <code class="prettyprint">customParameters</code>: Custom parameters. Example <code class="prettyprint">{ key: 'value' }</code>.</p></li>
<li><p> <code class="prettyprint">autoActivate</code>: Determines whether or not dynamically registered Platforms should be automatically activated. Defaults to <code class="prettyprint">false</code>.</p></li>
<li><p> <code class="prettyprint">useDeepLinking</code>: Deep Linking usage flag. If <code class="prettyprint">true</code>, sets up deep linking in the platform. Defaults to <code class="prettyprint">true</code>.</p></li>
</ul>
<blockquote>
  <p>If the <code class="prettyprint">dynReg</code> parameter is not specified in the provider options, the DynamicRegistrationService is disabled for the provider.</p>
</blockquote>
<p><strong>Example:</strong></p>
<pre class="prettyprint linenums"><code class="typescript language-typescript">import { register } from 'lti-typescript';
const provider = register(
  &lt;encryptionKey&gt;,
  &lt;databaseOptions&gt;,
  {
    ...
    dynReg: {
      url: 'http://tool.example.com', // Tool Provider URL. Required field.
      name: 'Tool Provider', // Tool Provider name. Required field.
      logo: 'http://tool.example.com/assets/logo.svg', // Tool Provider logo URL.
      description: 'Tool Description', // Tool Provider description.
      redirectUris: ['http://tool.example.com/launch'], // Additional redirection URLs. The main URL is added by default.
      customParameters: { key: 'value' }, // Custom parameters.
      autoActivate: false, // Whether or not dynamically registered Platforms should be automatically activated. Defaults to false.
    }, 
    ...
  }
);
</code></pre>
<h3 id="usingthedynamicregistrationservice">Using the Dynamic Registration Service</h3>
<p>Dynamic Registration is used when a Platform makes a <strong>registration request</strong> to the Tool's <strong>dynamic registration endpoint</strong>, <em> <code class="prettyprint">/register</code> by default</em>. Both parties will then exchange information and create the registrations.</p>
<p>Platform registrations created dynamically, by default, have to be manually activated. This can be done by using the <code class="prettyprint">Platform.platformActive</code> method:</p>
<pre class="prettyprint linenums"><code class="typescript language-typescript">// Retrieve Platform
const platform = await provider.getPlatform('http://platform.example.com', 'CLIENTID');
// Activate Platform
await platform.setActive(true);
</code></pre>
<p>By setting the <code class="prettyprint">options.dynReg.autoActivate</code> field to <code class="prettyprint">true</code> in the <code class="prettyprint">Provider.setup</code> method, dynamically registered Platforms can be automatically activated.</p>
<h4 id="customflow">Custom flow</h4>
<p>The Dynamic Registration flow can be customized by using the <code class="prettyprint">provider.onDynamicRegistration</code> method. This method allows us to control the registration flow to add additional screens, for example.</p>
<p>The registration can be finalized by calling the <code class="prettyprint">provider.DynamicRegistrationService.register</code> method passing the necessary query parameters and then appending the resulting message to the page HTML.</p>
<p>The following example is a representation of the default Dynamic Registration flow:</p>
<pre class="prettyprint linenums"><code class="typescript language-typescript">provider.onDynamicRegistration(async (req, res, next) =&gt; {
  try {
    if (!req.query.openid_configuration) return res.status(400).send({ status: 400, error: 'Bad Request', details: { message: 'Missing parameter: "openid_configuration".' } });
    const message = await provider.DynamicRegistrationService.register(req.query.openid_configuration, req.query.registration_token);
    res.setHeader('Content-type', 'text/html');
    res.send(message);
  } catch (err) {
    if (err.message === 'PLATFORM_ALREADY_REGISTERED') return res.status(403).send({ status: 403, error: 'Forbidden', details: { message: 'Platform already registered.' } });
    return res.status(500).send({ status: 500, error: 'Internal Server Error', details: { message: err.message } });
  }
});
</code></pre>
<p>You can also pass a third parameter to <code class="prettyprint">provider.DynamicRegistrationService.register</code> containing overrides for the default dynamic registration options.</p>
<p>The following example is a representation of the default Dynamic Registration flow with added custom parameters:</p>
<pre class="prettyprint linenums"><code class="typescript language-typescript">provider.onDynamicRegistration(async (req, res, next) =&gt; {
  try {
    if (!req.query.openid_configuration) return res.status(400).send({ status: 400, error: 'Bad Request', details: { message: 'Missing parameter: "openid_configuration".' } });
    const message = await lti.DynamicRegistrationService.register(req.query.openid_configuration, req.query.registration_token, {
      'https://purl.imsglobal.org/spec/lti-tool-configuration': {
        custom_parameters: {
          'custom1': 'value1',
          'custom2': 'value2'
        }
      }
    });
    res.setHeader('Content-type', 'text/html');
    res.send(message);
  } catch (err) {
    if (err.message === 'PLATFORM_ALREADY_REGISTERED') return res.status(403).send({ status: 403, error: 'Forbidden', details: { message: 'Platform already registered.' } });
    return res.status(500).send({ status: 500, error: 'Internal Server Error', details: { message: err.message } });
  }
});
</code></pre>
<hr>
<h2 id="license">License</h2>
<blockquote>
  <p><a href="../LICENSE">APACHE2 License</a></p>
  <p><em>Learning Tools Interoperability&#174; (LTI&#174;) is a trademark of the IMS Global Learning Consortium, Inc. (https://www.imsglobal.org)</em></p>
  <p><em>This library is a derivative work of <a href="https://github.com/Cvmcosta">CVM Costa</a>'s original <a href="https://github.com/Cvmcosta/ltijs">LTIJS library</a>.</em> </p>
</blockquote></body></html>
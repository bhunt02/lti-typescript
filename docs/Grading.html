<html><head><style>
html {
    box-sizing: border-box
}

body {
  padding: 2rem;
}

*,*:before,*:after {
    box-sizing: inherit
}

/* Extract from normalize.css by Nicolas Gallagher and Jonathan Neal git.io/normalize */
html {
    -ms-text-size-adjust: 100%;
    -webkit-text-size-adjust: 100%
}

body {
    margin: 0
}

article,aside,details,figcaption,figure,footer,header,main,menu,nav,section {
    display: block
}

summary {
    display: list-item
}

audio,canvas,progress,video {
    display: inline-block
}

progress {
    vertical-align: baseline
}

audio:not([controls]) {
    display: none;
    height: 0
}

[hidden],template {
    display: none
}

a {
    background-color: transparent
}

a:active,a:hover {
    outline-width: 0
}

abbr[title] {
    border-bottom: none;
    text-decoration: underline;
    text-decoration: underline dotted
}

b,strong {
    font-weight: bolder
}

dfn {
    font-style: italic
}

mark {
    background: #ff0;
    color: #000
}

small {
    font-size: 80%
}

sub,sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline
}

sub {
    bottom: -0.25em
}

sup {
    top: -0.5em
}

figure {
    margin: 1em 40px
}

img {
    border-style: none
}

code,kbd,pre,samp {
    font-family: monospace,monospace;
    font-size: 1em
}

hr {
    box-sizing: content-box;
    height: 0;
    overflow: visible
}

button,input,select,textarea,optgroup {
    font: inherit;
    margin: 0
}

optgroup {
    font-weight: bold
}

button,input {
    overflow: visible
}

button,select {
    text-transform: none
}

button,[type=button],[type=reset],[type=submit] {
    -webkit-appearance: button
}

button::-moz-focus-inner,[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner {
    border-style: none;
    padding: 0
}

button:-moz-focusring,[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring {
    outline: 1px dotted ButtonText
}

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: .35em .625em .75em
}

legend {
    color: inherit;
    display: table;
    max-width: 100%;
    padding: 0;
    white-space: normal
}

textarea {
    overflow: auto
}

[type=checkbox],[type=radio] {
    padding: 0
}

[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button {
    height: auto
}

[type=search] {
    -webkit-appearance: textfield;
    outline-offset: -2px
}

[type=search]::-webkit-search-decoration {
    -webkit-appearance: none
}

::-webkit-file-upload-button {
    -webkit-appearance: button;
    font: inherit
}

/* End extract */
html,body {
    font-family: Verdana,sans-serif;
    font-size: 15px;
    line-height: 1.5
}

html {
    overflow-x: hidden
}

h1 {
    font-size: 36px
}

h2 {
    font-size: 30px
}

h3 {
    font-size: 24px
}

h4 {
    font-size: 20px
}

h5 {
    font-size: 18px
}

h6 {
    font-size: 16px
}

.breadcrumb {
  padding: 0 0.5rem;
}

.breadcrumb ol {
  display: flex;
  flex-wrap: wrap;
  list-style: none;
  margin: 0;
  padding: 0;
  gap: 1rem;
  align-items: end;
}
</style><title>Grading Service Class Documentation</title></head><nav aria-label="Breadcrumb" class="breadcrumb"><ol><li><a href="/out/README.html">README</a></li><li><a href="/out/docs/DeepLinking.html">Deep Linking</a></li><li><a href="/out/docs/DynamicRegistration.html">Dynamic Registration</a></li><li><span aria-current="page">Grading</span></li><li><a href="/out/docs/Introduction.html">Introduction</a></li><li><a href="/out/docs/NamesAndRoles.html">Names And Roles</a></li><li><a href="/out/docs/Platform.html">Platform</a></li><li><a href="/out/docs/RedirectionURIs.html">Redirection URIs</a></li><li><a href="/out/docs/TableOfContents.html">Table Of Contents</a></li></ol></nav><body><h1 id="gradingserviceclassdocumentation">Grading Service Class Documentation</h1>
<h2 id="tableofcontents">Table of Contents</h2>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#documentation">Documentation</a></li>
<li><a href="#license">License</a></li>
</ul>
<hr>
<h2 id="introduction">Introduction</h2>
<p>LTI-Typescript implements the <a href="https://www.imsglobal.org/spec/lti-ags/v2p0/">LTI&#174; 1.3 Assignment and Grading Service Specification</a> in the form of the <strong>GradeService Class</strong>.</p>
<hr>
<h2 id="usage">Usage</h2>
<h3 id="sendinggradestoaplatform">Sending grades to a platform</h3>
<p>LTI-Typescript is able to send grades to a platform in the <a href="https://www.imsglobal.org/spec/lti-ags/v2p0/#score-publish-service">application/vnd.ims.lis.v1.score+json</a> LTI&#174; standard:</p>
<pre class="prettyprint linenums"><code class="json5 language-json5">{ 
  "userId" : "200",
  "scoreGiven" : 83,
  "scoreMaximum" : 100,
  "comment" : "This is exceptional work.",
  "activityProgress" : "Completed",
  "gradingProgress": "FullyGraded"
}
</code></pre>
<blockquote>
  <p>This excludes the <em>timestamp</em> field of the specification, because the submitScore method generates it automatically.</p>
</blockquote>
<h4 id="submittinggrades">Submitting Grades</h4>
<pre class="prettyprint linenums"><code class="typescript language-typescript">/**
 * sendGrade
 */
provider.app.post('/grade', async (req, res) =&gt; {
  try {
    const idtoken = res.locals.token; // IdToken
    const score = req.body.grade; // User numeric score sent in the body
    // Creating Grade object
    const gradeObj = {
      userId: idtoken.user,
      scoreGiven: score,
      scoreMaximum: 100,
      activityProgress: 'Completed',
      gradingProgress: 'FullyGraded',
    };

    // Selecting lineItem ID
    let lineItemId = idtoken.platformContext.endpoint.lineitem; // Attempting to retrieve it from idtoken
    if (!lineItemId) {
      const response = await provider.GradeService.getLineItems(idtoken, { resourceLinkId: true });
      const lineItems = response.lineItems;
      if (lineItems.length === 0) {
        // Creating line item if there is none
        console.log('Creating new line item');
        const newLineItem = {
          scoreMaximum: 100,
          label: 'Grade',
          tag: 'grade',
          resourceLinkId: idtoken.platformContext.resource.id,
        }
        const lineItem = await provider.GradeService.createLineItem(idtoken, newLineItem);
        lineItemId = lineItem.id;
      } else lineItemId = lineItems[0].id;
    }

    // Sending Grade
    const responseGrade = await provider.GradeService.submitScore(idtoken, lineItemId, gradeObj);
    return res.send(responseGrade);
  } catch (err) {
    return res.status(500).send({ err: err.message });
  }
});
</code></pre>
<h5 id="retrievinggrades">Retrieving Grades</h5>
<p>LTI-Typescript is able to retrieve grades from a platform:</p>
<pre class="prettyprint linenums"><code class="typescript language-typescript">provider.app.get('/grade', async (req, res) =&gt; {
  // Retrieves grades from a platform, only for the current user
  const idtoken = res.locals.token; // IdToken
  const response = await provider.GradeService.getScores(idtoken, idtoken.platformContext.endpoint.lineitem, { userId: idtoken.user });
  return res.send(result);
});
</code></pre>
<h5 id="lineitemretrievalcreationupdateanddeletionexample">Line Item Retrieval, Creation, Update, and Deletion Example</h5>
<pre class="prettyprint linenums"><code class="typescript language-typescript">// Retrieving lineitems
provider.app.get('/lineitem', async (req, res) =&gt; {
  // Retrieves lineitems from a platform
  const result  = await provider.GradeService.getLineItems(res.locals.token);
  return res.send(result);
});

// Creating lineitem
provider.app.post('/lineitem', async (req, res) =&gt; {
  const lineItem = {
    scoreMaximum: 100,
    label: 'Grade',
    tag: 'grade',
  };
  // Sends lineitem to a platform
  await provider.GradeService.createLineItem(res.locals.token, lineItem);
  return res.sendStatus(201);
});

// Update lineitem
provider.app.post('/lineitem', async (req, res) =&gt; {
  const lineItem = {
    scoreMaximum: 100,
    label: 'Grade',
    tag: 'grade',
  };
  // Sends lineitem to a platform
  await provider.GradeService.updateLineItemById(res.locals.token, req.body.lineitemid, lineItem);
  return res.sendStatus(201);
});

// Delete lineitem
provider.app.delete('/lineitems', async (req, res) =&gt; {
  // Deleting lineitem on a platform
  await provider.GradeService.deleteLineItemById(res.locals.token, req.body.lineitemid, { tag: 'tag' });
  return res.sendStatus(204);
});
</code></pre>
<h2 id="documentation">Documentation</h2>
<h4 id="getlineitemsidtokenidtokenoptionsaccesstokenaccesstokentypepromiseresulttype">getLineItems(idToken: IdToken, options?: { â€¦ }, accessToken?: AccessTokenType): Promise<resulttype>;</resulttype></h4>
<ul>
<li>Gets line items filtered by (if present) any of the specified options.</li>
<li>Parameters:</li>
<li> <code class="prettyprint">idToken</code>: Identifier token for the request.</li>
<li> <code class="prettyprint">options</code>: Options for the request.<ul>
<li> <code class="prettyprint">options.resourceLinkId = false</code> - Filters line items based on the resourceLinkId of the resource that originated the request, if not false. </li>
<li> <code class="prettyprint">options.resourceId = false</code> - Filters line items based on the resourceId, if not false.</li>
<li> <code class="prettyprint">options.tag = false</code> - Filters line items based on the tag, if not false.</li>
<li> <code class="prettyprint">options.limit = false</code> - Sets a maximum number of line items to be returned, if not false. </li>
<li> <code class="prettyprint">options.id = false</code> - Filters line items based on the id, if not false.</li>
<li> <code class="prettyprint">options.label = false</code> - Filters line items based on the label, if not false.</li>
<li> <code class="prettyprint">options.url = false</code> - Retrieves line items from a specific URL, if not false. Usually retrieved from the <code class="prettyprint">next</code> link header of a previous request.</li></ul></li>
<li> <code class="prettyprint">accessToken</code>: Optional, pre-retrieved access token to perform the request.<ul>
<li>If the access token does not have valid scopes or is expired, a new one will be requested.</li></ul></li>
</ul>
<h4 id="getlineitembyididtokenidtokenlineitemidstringaccesstokenaccesstokentypepromiselineitem">getLineItemById(idToken: IdToken, lineItemId: string, accessToken?: AccessTokenType): Promise<lineitem>;</lineitem></h4>
<ul>
<li>Gets a specific line item by ID if it exists.</li>
<li>Parameters:<ul>
<li> <code class="prettyprint">idToken</code>: Identifier token for the request.</li>
<li> <code class="prettyprint">lineItemId</code>: Identifier/url for the line item.</li>
<li> <code class="prettyprint">accessToken</code>: Optional, pre-retrieved access token to perform the request.</li>
<li>If the access token does not have valid scopes or is expired, a new one will be requested.</li></ul></li>
</ul>
<h4 id="createlineitemidtokenidtokenlineitemcreatelineitemoptionsresourcelinkidbooleanfalseaccesstokenaccesstokentypepromiselineitem">createLineItem(idToken: IdToken, lineItem: CreateLineItem, options?: { resourceLinkId: boolean = false }, accessToken?: AccessTokenType): Promise<lineitem>;</lineitem></h4>
<ul>
<li>Creates a new Line Item.</li>
<li>Parameters:<ul>
<li> <code class="prettyprint">idToken</code>: Identifier token for the request.</li>
<li> <code class="prettyprint">lineItem</code>: CreateLineItem Object, following the application/vnd.ims.lis.v2.lineitem+json specification</li>
<li> <code class="prettyprint">accessToken</code>: Optional, pre-retrieved access token to perform the request.</li>
<li>If the access token does not have valid scopes or is expired, a new one will be requested.</li></ul></li>
</ul>
<h4 id="updatelineitemidtokenidtokenlineitemidstringlineitemcreatelineitemaccesstokenaccesstokentypepromiselineitem">updateLineItem(idToken: IdToken, lineItemId: string, lineItem: CreateLineItem, accessToken?: AccessTokenType): Promise<lineitem>;</lineitem></h4>
<ul>
<li>Updates an existing Line Item.</li>
<li>Parameters:<ul>
<li> <code class="prettyprint">idToken</code>: Identifier token for the request.</li>
<li> <code class="prettyprint">lineItemId</code>: Identifier/url for the line item.</li>
<li> <code class="prettyprint">lineItem</code>: CreateLineItem Object, following the application/vnd.ims.lis.v2.lineitem+json specification</li>
<li> <code class="prettyprint">accessToken</code>: Optional, pre-retrieved access token to perform the request.</li>
<li>If the access token does not have valid scopes or is expired, a new one will be requested.</li></ul></li>
</ul>
<h4 id="deletelineitembyididtokenidtokenlineitemidstringaccesstokenaccesstokentypepromiseboolean">deleteLineItemById(idToken: IdToken, lineItemId: string, accessToken?: AccessTokenType): Promise<boolean>;</boolean></h4>
<ul>
<li>Deletes an existing Line Item.</li>
<li>Parameters:<ul>
<li> <code class="prettyprint">idToken</code>: Identifier token for the request.</li>
<li> <code class="prettyprint">lineItemId</code>: Identifier/url for the line item.</li>
<li> <code class="prettyprint">accessToken</code>: Optional, pre-retrieved access token to perform the request.<ul>
<li>If the access token does not have valid scopes or is expired, a new one will be requested.</li></ul></li></ul></li>
</ul>
<h4 id="submitscoreidtokenidtokenlineitemidstringscoreomitscoreitemtimestampaccesstokenaccesstokentypepromisescoreitem">submitScore(idToken: IdToken, lineItemId: string, score: Omit<scoreitem,'timestamp'>, accessToken?: AccessTokenType): Promise<scoreitem>;</scoreitem></scoreitem,'timestamp'></h4>
<ul>
<li><ul>
<li>Submits a score for an existing Line Item.</li></ul></li>
<li>Parameters:<ul>
<li> <code class="prettyprint">idToken</code>: Identifier token for the request.</li>
<li> <code class="prettyprint">lineItemId</code>: Identifier/url for the line item.</li>
<li> <code class="prettyprint">score</code>: ScoreItem excluding <code class="prettyprint">timestamp</code> property as it is generated in the method.</li>
<li> <code class="prettyprint">accessToken</code>: Optional, pre-retrieved access token to perform the request.<ul>
<li>If the access token does not have valid scopes or is expired, a new one will be requested.</li></ul></li></ul></li>
</ul>
<hr>
<h2 id="license">License</h2>
<blockquote>
  <p><a href="../LICENSE">APACHE2 License</a></p>
  <p><em>Learning Tools Interoperability&#174; (LTI&#174;) is a trademark of the IMS Global Learning Consortium, Inc. (https://www.imsglobal.org)</em></p>
  <p><em>This library is a derivative work of <a href="https://github.com/Cvmcosta">CVM Costa</a>'s original <a href="https://github.com/Cvmcosta/ltijs">LTIJS library</a>.</em> </p>
</blockquote></body></html>